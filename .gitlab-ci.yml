image: gcc

before_script:
    - apt update && apt install -y cmake libhdf5-serial-dev

tests:
    only:
        - pushes
    script:
        - mkdir build
        - cd build
        - cmake ..
        - make -j4
        - ./tests

build:
    only:
        - tags
    script:
        - mkdir build
        - cd build
        - cmake .. -DTAG=$CI_COMMIT_TAG
        - make package
        - mv *.deb ..
    artifacts:
        paths:
            - "*.deb"
